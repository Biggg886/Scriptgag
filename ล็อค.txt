local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")

-- UI และปุ่มเลือกเป้าหมายเหมือนเดิม (ข้ามไปทำเหมือนก่อนหน้านี้)
-- ตัวแปรหลัก:
local lockedTarget = nil
local isLocked = false
local toggleKey = Enum.KeyCode.G
local espObjects = {}

-- ฟังก์ชันสร้าง ESP
local function createESP(target)
    if espObjects[target] then espObjects[target]:Destroy() end
    if target.Character then
        local highlight = Instance.new("Highlight")
        highlight.FillColor = Color3.fromRGB(255, 0, 0)
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.Adornee = target.Character
        highlight.Parent = target.Character
        espObjects[target] = highlight
    end
end

local function removeESP(target)
    if espObjects[target] then
        espObjects[target]:Destroy()
        espObjects[target] = nil
    end
end

-- ปุ่มกด G เปิด/ปิดการล็อค
UIS.InputBegan:Connect(function(input, gpe)
    if not gpe and input.KeyCode == toggleKey then
        if lockedTarget then
            isLocked = not isLocked
            if isLocked then
                camera.CameraType = Enum.CameraType.Scriptable -- กล้องถูกควบคุม
            else
                camera.CameraType = Enum.CameraType.Custom -- คืนค่ากล้องปกติ
            end
        end
    end
end)

-- ล็อคกล้องและหมุนตัวละคร
RS.RenderStepped:Connect(function()
    if isLocked and lockedTarget and lockedTarget.Character and lockedTarget.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = lockedTarget.Character.HumanoidRootPart
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            -- หมุนตัวละครหันไปหาเป้าหมาย
            local myRoot = char.HumanoidRootPart
            myRoot.CFrame = CFrame.new(myRoot.Position, Vector3.new(hrp.Position.X, myRoot.Position.Y, hrp.Position.Z))
        end

        -- ล็อคกล้องให้มองเป้า
        local camPos = camera.CFrame.Position
        camera.CFrame = CFrame.new(camPos, hrp.Position)
    end
end)
